<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TK Suite ‚Äî Mail & Account Tools</title>

  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="preconnect" href="https://www.googleapis.com">
  <link rel="preconnect" href="https://firestore.googleapis.com">
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDiwjp-OoPJ3VwC068gvhTJ3swdjFc8k5A",
      authDomain: "lockey-238c0.firebaseapp.com",
      projectId: "lockey-238c0",
      storageBucket: "lockey-238c0.firebasestorage.app",
      messagingSenderId: "1097009271087",
      appId: "1:1097009271087:web:0f5cd5b55c917bbe21d1da",
      measurementId: "G-PNCE5DYWQK"
    };
  </script>

  <style>
    /* === üé® B·∫ÆT ƒê·∫¶U N√ÇNG C·∫§P GIAO DI·ªÜN NEON 2025 === */
    :root{
      /* M√†u Neon M·ªõi */
      --green-500: #00ff9d; /* Xanh Neon */
      --green-600: #00e68e;
      --green-700: #00c77a;
      --green-glow: rgba(0, 255, 157, 0.4);
      --green-glow-strong: rgba(0, 255, 157, 0.7);
      
      --blue-accent: #00f0ff; /* Xanh Cyan Neon */
      --blue-glow: rgba(0, 240, 255, 0.3);
      --blue-glow-strong: rgba(0, 240, 255, 0.6);

      /* Ch·∫ø ƒë·ªô t·ªëi (M·∫∑c ƒë·ªãnh) */
      --bg: #010a19; /* N·ªÅn xanh ƒëen cyber */
      --bg-soft: #010a19;
      --fg: #e5f0ff; /* Ch·ªØ s√°ng */
      --muted: #88a0c2; /* Ch·ªØ m·ªù */
      --card: rgba(10, 20, 39, 0.85); /* Hi·ªáu ·ª©ng Glassmorphism */
      --line: rgba(0, 240, 255, 0.25); /* Vi·ªÅn Cyan m·ªù */
      --shadow-soft: 0 24px 60px rgba(0,0,0,0.9);
      
      --radius: 18px;
      --danger: #ff4d4d;
      --danger-soft: rgba(255, 77, 77, 0.15);
      --warning: #f9b500;
      --warning-soft: rgba(249, 181, 0, 0.15);
    }

    /* Ch·∫ø ƒë·ªô S√°ng (Vibrant) */
    body[data-theme="light"]{
      --bg: #f4f7fa; /* N·ªÅn x√°m r·∫•t nh·∫°t */
      --bg-soft: #f4f7fa;
      --fg: #111827; /* Ch·ªØ ƒëen */
      --muted: #6b7280; /* Ch·ªØ m·ªù */
      --card: #ffffff; /* Th·∫ª tr·∫Øng */
      --line: #dce3ed; /* Vi·ªÅn x√°m nh·∫°t */
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.05);

      --danger-soft: #fee2e2;
      --warning-soft: #ffedd5;
    }
    
    /* ƒê·ªìng b·ªô ch·∫ø ƒë·ªô S√°ng */
    body[data-theme="light"]{
      background: var(--bg-soft);
    }
    body[data-theme="light"] .app{
      background: var(--card);
      border-color: var(--line);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: none; /* B·ªè blur ·ªü ch·∫ø ƒë·ªô s√°ng */
      -webkit-backdrop-filter: none;
    }
    body[data-theme="light"] .app::before{
      opacity: 0.1;
    }
    body[data-theme="light"] .card{
      background: var(--card);
      border-color: var(--line);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }
    body[data-theme="light"] .card:hover{
      border-color: var(--green-500);
      box-shadow: 0 6px 15px var(--green-glow);
    }
    body[data-theme="light"] .card:hover::before{
      opacity: 0.2;
    }
    
    /* N√∫t ·ªü ch·∫ø ƒë·ªô s√°ng */
    body[data-theme="light"] .tab{
      background: #eef2f9; 
      color: var(--muted);
      border-color: transparent;
      text-shadow: none;
      box-shadow: none;
    }
    body[data-theme="light"] .tab[aria-selected="true"]{
      background: var(--green-500); /* ƒê·ªìng b·ªô m√†u Neon */
      color: #010a19; /* Ch·ªØ ƒëen */
      box-shadow: 0 4px 15px var(--green-glow);
    }
    body[data-theme="light"] .btn{
      background: var(--green-500);
      color: #010a19;
      box-shadow: 0 4px 15px var(--green-glow);
    }
    body[data-theme="light"] .btn.ghost{
      background: #ffffff;
      color: #334155;
      border-color: var(--line);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      text-shadow: none;
    }
    body[data-theme="light"] .btn.ghost:hover{
      border-color: #a0a0a0;
      box-shadow: none;
    }
    body[data-theme="light"] .icon-btn{
      background: #ffffff;
      color: #334155;
      border-color: var(--line);
      text-shadow: none;
    }
    body[data-theme="light"] .icon-btn:hover{
      border-color: var(--green-500);
      color: var(--green-500);
      box-shadow: 0 4px 12px var(--green-glow);
    }
    
    /* Input ·ªü ch·∫ø ƒë·ªô s√°ng */
    body[data-theme="light"] textarea,
    body[data-theme="light"] input[type="text"],
    body[data-theme="light"] input[type="number"],
    body[data-theme="light"] input[type="date"]{
      background: #ffffff;
      color: var(--fg);
      box-shadow: none;
      border-color: var(--line);
    }
    body[data-theme="light"] textarea:focus,
    body[data-theme="light"] input:focus{
      border-color: var(--green-500);
      box-shadow: 0 0 0 2px var(--green-glow);
    }
    
    /* Ti√™u ƒë·ªÅ & Badge ·ªü ch·∫ø ƒë·ªô s√°ng */
    body[data-theme="light"] .brand-title,
    body[data-theme="light"] .card-head h3,
    body[data-theme="light"] .label-title,
    body[data-theme="light"] .pill-main strong,
    body[data-theme="light"] .history-header-title {
      color: var(--fg);
      text-shadow: none;
    }
    body[data-theme="light"] .cloud-status,
    body[data-theme="light"] .badge,
    body[data-theme="light"] .acc-badge,
    body[data-theme="light"] .h-tag {
      background: #f1f5f9;
      color: var(--muted);
      border-color: var(--line);
      text-shadow: none;
    }
    body[data-theme="light"] .pill-radio{
      background: #ffffff;
      border-color: var(--line);
    }
    body[data-theme="light"] .pill-radio:hover{
      background: #f8fafc;
      border-color: var(--green-500);
    }
    
    /* Fix tab T√†i kho·∫£n ·ªü ch·∫ø ƒë·ªô s√°ng */
    body[data-theme="light"] .acc-item{
      background: #fafcff;
      border-color: var(--line);
      box-shadow: none;
    }
    body[data-theme="light"] .acc-head-btn{
      background: #ffffff;
    }
    body[data-theme="light"] .acc-head-btn:hover{
      background: #fcfdff;
    }
    body[data-theme="light"] .acc-user-row{
      background: #f4f7fa;
      border-color: var(--line);
    }
    body[data-theme="light"] .acc-badge-warning{
      background: var(--warning-soft);
      color: #f9b500;
      border-color: #fed7aa;
    }
    body[data-theme="light"] .acc-badge-error{
      background: var(--danger-soft);
      color: #ff4d4d;
      border-color: #fca5a5;
    }
    body[data-theme="light"] .acc-badge-expired{
      background: #e5e7eb;
      color: #4b5563;
      border-color: #d1d5db;
    }
    body[data-theme="light"] .h-item{
      background: #ffffff;
      border-color: var(--line);
      box-shadow: none;
    }
    body[data-theme="light"] .h-btn{
      background: rgba(0, 255, 157, 0.1);
    }
    body[data-theme="light"] .h-line1 { color: var(--fg); }
    body[data-theme="light"] .history-ta {
      background: #f9fafb;
      color: var(--fg);
      border-color: var(--line);
    }
    /* === K·∫æT TH√öC N√ÇNG C·∫§P GIAO DI·ªÜN === */


    *{box-sizing:border-box;}
    html,body{min-height:100%;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(0, 240, 255, 0.2), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(0, 255, 157, 0.2), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(0, 255, 157, 0.15), transparent 55%),
        var(--bg-soft);
      color:var(--fg);
      padding:16px 8px 32px;
    }

    .app{
      width:100%;
      max-width:430px;
      padding:16px 12px 24px;
      margin:16px auto 32px;
      border-radius:26px;
      background: rgba(10, 20, 39, 0.85); /* N·ªÅn glass */
      box-shadow:var(--shadow-soft);
      border: 1px solid var(--line);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(12px); /* Hi·ªáu ·ª©ng blur */
      -webkit-backdrop-filter: blur(12px);
    }
    .app::before{
      content:"";
      position:absolute;
      inset:-120px;
      background:
        radial-gradient(circle at 10% 0%, rgba(0, 255, 157, 0.1), transparent 55%),
        radial-gradient(circle at 90% 10%, rgba(0, 240, 255, 0.1), transparent 55%);
      opacity:0.9;
      pointer-events:none;
      z-index:-1;
    }

    @media (min-width:768px){
      body{
        padding:32px 16px 48px;
      }
      .app{
        max-width:920px;
        padding:22px 20px 30px;
        border-radius:28px;
        margin:24px auto 40px;
      }
    }
    @media (min-width:1024px){
      .app{
        max-width:1100px;
        padding:26px 24px 34px;
      }
    }

    /* HEADER */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
    }
    .topbar-left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-box{
      width:36px;
      height:36px;
      border-radius:999px;
      overflow:hidden;
      box-shadow:0 0 20px rgba(0, 255, 157, 0.3);
      border:1px solid var(--green-500);
      background: #010a19;
      display:flex;
      align-items:center;
      justify-content:center;
      transform:translateY(0);
      transition:.2s transform ease,.2s box-shadow ease;
    }
    .logo-box img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .logo-box:hover{
      transform:translateY(-2px);
      box-shadow:0 0 30px var(--green-glow-strong);
    }
    .brand-title{
      font-size:17px;
      font-weight:800;
      letter-spacing:.03em;
      color:var(--fg);
      text-shadow: 0 0 5px var(--green-glow);
    }
    .brand-sub{
      font-size:11px;
      color:var(--muted);
    }

    .topbar-actions{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .icon-btn{
      width:34px;
      height:34px;
      border-radius:999px;
      border:1px solid var(--line);
      background: transparent;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:17px;
      cursor:pointer;
      transition:.2s transform ease,.2s box-shadow ease,.18s border-color ease,.18s background ease;
      color:var(--muted);
      text-shadow: 0 0 3px var(--blue-glow);
    }
    .icon-btn:hover{
      transform:translateY(-1px);
      border-color: var(--blue-accent);
      color: var(--blue-accent);
      box-shadow: 0 0 10px var(--blue-glow-strong);
      background: rgba(0, 240, 255, 0.1);
    }

    .btn{
      appearance:none;
      border-radius:999px;
      border:1px solid transparent;
      background: var(--green-500);
      color: #010a19; /* Ch·ªØ ƒëen cho n·ªïi b·∫≠t */
      padding:7px 12px;
      font-size:12px;
      font-weight:700; /* ƒê·∫≠m h∆°n */
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      white-space:nowrap;
      transition:.16s transform ease,.16s box-shadow ease,.16s background ease,.16s border-color ease,.16s opacity ease;
      box-shadow: 0 0 12px var(--green-glow);
    }
    .btn.small{padding:5px 10px;font-size:11px;}
    .btn:active{transform:translateY(1px);}
    .btn.full{width:100%;justify-content:center;}
    .btn.ghost{
      background: transparent;
      border-color: var(--line);
      color: var(--muted);
      box-shadow: none;
      font-weight: 600;
    }
    .btn.ghost:hover{
      border-color: var(--blue-accent);
      color: var(--blue-accent);
      box-shadow: 0 0 8px var(--blue-glow);
      background: rgba(0, 240, 255, 0.1);
      text-shadow: 0 0 3px var(--blue-glow);
    }
    .btn.danger{
      background: var(--danger);
      border-color: transparent;
      color: #ffffff;
      box-shadow: 0 0 12px rgba(255, 77, 77, 0.5);
    }

    .cloud-status{
      font-size:10px;
      color:var(--muted);
      padding:3px 7px;
      border-radius:999px;
      border:1px solid var(--line);
      background: transparent;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .cloud-dot{
      width:7px;
      height:7px;
      border-radius:999px;
      background: var(--blue-accent);
      box-shadow: 0 0 8px var(--blue-glow-strong);
    }

    /* TABS */
    .tabs{
      display:flex;
      gap:6px;
      margin-bottom:12px;
      overflow-x:auto;
      padding-bottom:4px;
      scrollbar-width:none;
    }
    .tabs::-webkit-scrollbar{display:none;}

    .tab{
      appearance:none;
      border-radius:999px;
      border:1px solid var(--line);
      background: transparent;
      padding:6px 11px;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      white-space:nowrap;
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow: none;
      transition:.18s transform ease,.18s box-shadow ease,.18s border-color ease,.18s background ease,.18s color ease;
    }
    .tab-icon{font-size:13px;}
    .tab[aria-selected="true"]{
      color: #010a19; /* Ch·ªØ ƒëen */
      border-color: transparent;
      background: var(--green-500);
      box-shadow: 0 0 15px var(--green-glow-strong);
      transform:translateY(-1px);
      font-weight: 700;
    }

    .panel{display:block;animation:panelIn .22s ease;}
    .panel[hidden]{display:none;}

    @keyframes panelIn{
      from{opacity:0;transform:translateY(6px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* CARD */
    .card{
      background: var(--card);
      border-radius:var(--radius);
      border: 1px solid var(--line);
      box-shadow: 0 18px 40px rgba(0,0,0,0.7);
      margin-bottom:12px;
      overflow:hidden;
      position:relative;
      transform:translateY(0);
      transition:.2s transform ease,.2s box-shadow ease,.2s border-color ease,.2s background ease;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 0 0, rgba(0, 255, 157, 0.1), transparent 55%);
      opacity:0;
      pointer-events:none;
      transition:.2s opacity ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow: 0 0 25px var(--green-glow);
      border-color: var(--green-500);
    }
    .card:hover::before{opacity:1;}

    .card-head{
      padding:9px 11px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .card-head h3{
      margin:0;
      font-size:13px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:6px;
      color:var(--fg);
    }
    .card-body{padding:10px 11px 11px;}

    .badge{
      padding:3px 7px;
      border-radius:999px;
      border: 1px solid var(--line);
      font-size:10px;
      color:var(--muted);
      background: transparent;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .field{margin-bottom:8px;}
    .label{
      font-size:11px;
      font-weight:600;
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:4px;
      color:var(--fg);
    }
    .label-title{
      font-size:12px;
      font-weight:600;
      color:var(--fg);
    }

    textarea,
    input[type="text"],
    input[type="number"],
    input[type="date"]{
      width:100%;
      border-radius:14px;
      border: 1px solid var(--line);
      padding:9px 11px;
      font-size:13px;
      font-family:inherit;
      background: rgba(0,0,0,0.2);
      color:var(--fg);
      outline:none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3) inset;
      transition:.16s border-color ease,.16s box-shadow ease,.16s background ease;
    }
    textarea::placeholder,
    input::placeholder{
      color: var(--muted);
    }
    textarea:focus,
    input:focus{
      border-color: var(--green-500);
      box-shadow: 0 0 0 2px var(--green-glow), 0 5px 15px rgba(0,0,0,0.3) inset;
      background: rgba(0, 15, 30, 0.3);
    }
    textarea{
      min-height:190px;
      resize:vertical;
      line-height:1.45;
    }

    .mono{
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }

    .pill-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .pill-column{flex-direction:column;}
    .pill-radio{
      flex:1 1 auto;
      border-radius:999px;
      border: 1px solid var(--line);
      padding:7px 9px;
      display:flex;
      align-items:flex-start;
      gap:6px;
      cursor:pointer;
      font-size:11px;
      background: transparent;
      transition:.16s border-color ease,.16s background ease,.16s box-shadow ease;
    }
    .pill-radio input{
      margin-top:2px;
      accent-color: var(--green-500);
    }
    .pill-main{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .pill-main strong{font-size:11px;color:var(--fg);}
    .pill-main span{color:var(--muted);}
    .pill-radio:hover{
      border-color: var(--green-500);
      box-shadow: 0 0 10px var(--green-glow);
      background: rgba(0, 255, 157, 0.1);
    }

    .checkbox-inline{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:11px;
      color:var(--muted);
    }
    .checkbox-inline input{accent-color:var(--green-500);}

    /* === üìê S·ª¨A L·ªñI LAYOUT K·∫æT QU·∫¢ === */
    .card-head.result-head{
      flex-direction: row; /* LU√îN LU√îN l√† 1 h√†ng */
      align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
      gap: 8px;
    }
    .result-head{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:4px;
      width:100%;
    }
    .result-head-main{
      width: auto; /* B·ªè width 100% */
      flex: 1 1 auto; /* Cho ph√©p co gi√£n */
      display:flex;
      align-items:center;
      justify-content: flex-start; /* Kh√¥ng ƒë·∫©y n√∫t "L∆∞u" ra xa */
      gap: 8px; /* Th√™m kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
    }
    .result-head-main-left{
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .result-head-main-left h3,
    .result-head-main-left .badge{
      white-space:nowrap;
    }
    .result-head-actions{
      width: auto; /* B·ªè width 100% */
      flex: 0 0 auto; /* Kh√¥ng co gi√£n, gi·ªØ k√≠ch th∆∞·ªõc */
      display:flex;
      flex-wrap:wrap;
      justify-content:flex-end;
      gap:6px;
      margin-top: 0; /* B·ªè margin top */
    }
    /* === K·∫æT TH√öC S·ª¨A LAYOUT === */


    /* HISTORY overlay */
    .history-overlay{
      position:fixed;
      inset:0;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:14px 10px;
      opacity:0;
      pointer-events:none;
      transition:.18s opacity ease;
      z-index:50;
    }
    .history-overlay.open{
      opacity:1;
      pointer-events:auto;
    }
    .history-backdrop{
      position:absolute;
      inset:0;
      background:rgba(1, 10, 25, 0.75);
      backdrop-filter:blur(8px);
      -webkit-backdrop-filter:blur(8px);
    }
    .history-sheet{
      position:relative;
      width:100%;
      max-width:430px;
      border-radius:20px;
      border: 1px solid var(--line);
      background: var(--card);
      box-shadow:0 24px 70px rgba(0,0,0,0.95);
      max-height:calc(100vh - 40px);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      animation:panelIn .2s ease;
    }

    @media (min-width:768px){
      .history-overlay{
        align-items:center;
        padding:22px 16px;
      }
      .history-sheet{
        max-width:780px;
        max-height:calc(100vh - 80px);
      }
    }
    @media (min-width:1024px){
      .history-sheet{
        max-width:980px;
      }
    }

    .history-header{
      padding:8px 11px 6px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .history-header-title{
      font-size:13px;
      font-weight:700;
      color:var(--fg);
    }
    .history-header-sub{
      font-size:11px;
      color:var(--muted);
    }
    .history-actions{
      padding:6px 10px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:6px;
    }
    .history-actions-right{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    .history-list{
      padding:8px 10px 10px;
      overflow:auto;
      flex:1 1 auto;
    }
    .history-empty{
      font-size:12px;
      color:var(--muted);
    }
    .h-item{
      border-radius:14px;
      border: 1px solid var(--line);
      margin-bottom:8px;
      overflow:hidden;
      background: rgba(0,0,0,0.2);
      box-shadow:0 10px 26px rgba(0,0,0,0.7);
    }
    .h-btn{
      width:100%;
      text-align:left;
      border:none;
      background: rgba(0, 255, 157, 0.1);
      padding:7px 9px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
    }
    .h-main{
      display:flex;
      flex-direction:column;
      gap:2px;
      flex:1;
      min-width:0;
    }
    .h-line1{font-size:12px;font-weight:600;color:var(--fg);}
    .h-line2{
      font-size:11px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .h-tag{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      border: 1px solid var(--line);
      background: transparent;
      color:var(--muted);
    }
    .h-body{
      display:none;
      padding:8px 9px 9px;
      border-top: 1px solid var(--line);
    }
    .h-cols{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .history-ta{
      width:100%;
      min-height:70px;
      resize:vertical;
      border-radius:10px;
      border: 1px solid var(--line);
      padding:7px 8px;
      font-size:11px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      background: rgba(0,0,0,0.2);
      color:var(--fg);
    }
    
    /* ‚≠êÔ∏è M·ªöI: CSS cho 4 n√∫t l·ªãch s·ª≠ */
    .h-body-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:8px;
    }

    /* TOAST */
    #toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: var(--green-500);
      color: #010a19;
      padding:7px 16px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      box-shadow: 0 0 20px var(--green-glow-strong);
      opacity:0;
      transition:.18s opacity ease,.18s transform ease;
      z-index:60;
      pointer-events:none;
    }
    #toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-2px);
    }

    /* ACCOUNT MANAGER */
    .acc-form-actions{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .acc-users{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .acc-user-row{
      padding:6px 8px;
      border-radius:12px;
      border: 1px dashed var(--line);
      background: rgba(0,0,0,0.2);
    }
    .acc-user-row-title{
      font-size:11px;
      font-weight:600;
      margin-bottom:4px;
      color:var(--fg);
    }
    .acc-list-empty{
      font-size:12px;
      color:var(--muted);
    }
    .acc-item{
      border-radius:14px;
      border: 1px solid var(--line);
      margin-bottom:8px;
      overflow:hidden;
      background: rgba(0,0,0,0.2);
      box-shadow:0 14px 36px rgba(0,0,0,0.7);
    }
    .acc-head-btn{
      width:100%;
      text-align:left;
      border:none;
      background: transparent;
      padding:8px 9px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      transition: .15s background ease;
    }
    .acc-head-btn:hover{
      background: rgba(0, 240, 255, 0.05);
    }
    .acc-title{
      font-size:12px;
      font-weight:600;
      color:var(--fg);
    }
    .acc-sub{
      font-size:11px;
      color:var(--muted);
    }
    .acc-badges{
      margin-left:auto;
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      font-size:10px;
      align-items:center;
    }
    .acc-badge{
      padding:2px 6px;
      border-radius:999px;
      border: 1px solid var(--line);
      background: transparent;
      color:var(--muted);
    }
    .acc-badge-warning{
      background: var(--warning-soft);
      color: var(--warning);
      border-color: var(--warning);
      text-shadow: 0 0 5px var(--warning-soft);
    }
    .acc-badge-error{
      background: var(--danger-soft);
      color: var(--danger);
      border-color: var(--danger);
      text-shadow: 0 0 5px var(--danger-soft);
    }
    .acc-badge-expired{
      background: rgba(136, 160, 194, 0.1);
      color: var(--muted);
      border-color: var(--muted);
    }
    .acc-countdown{
      font-size:11px;
      color:var(--muted);
      margin-left:4px;
    }
    .acc-body{
      display:none;
      padding:8px 9px 9px;
      border-top: 1px solid var(--line);
    }
    .acc-body-grid{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .acc-body-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }
    .pill-inline{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:11px;
      color:var(--muted);
    }

    /* RESPONSIVE PANELS: 2 C·ªòT TR√äN PC */
    @media (min-width:900px){
      .panel:not([hidden]){
        display:grid;
        grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
        gap:12px;
        align-items:flex-start;
      }
      .panel:not([hidden]) .card{
        margin-bottom:0;
      }
    }
  </style>
</head>
<body data-theme="dark">
<div class="app">
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-box">
  <img src="logo.png" alt="Logo">
</div>
      <div>
        <div class="brand-title">TK Suite</div>
        <div class="brand-sub">Mail ‚Ä¢ Key ‚Ä¢ T√†i kho·∫£n</div>
      </div>
    </div>
    <div class="topbar-actions">
      <span class="cloud-status" id="cloudStatus">
        <span class="cloud-dot"></span> Cloud: ƒëang k·∫øt n·ªëi‚Ä¶
      </span>
      <button class="icon-btn" id="btnToggleTheme" title="Dark / Light">üåô</button>
      <button class="btn ghost small" id="toggleHistoryBtn">L·ªãch s·ª≠</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab" id="tabAccounts" aria-selected="true">
      <span class="tab-icon">üë•</span>T√†i kho·∫£n
    </button>
    <button class="tab" id="tabCleaner" aria-selected="false">
      <span class="tab-icon">‚úâÔ∏è</span>Cleaner
    </button>
    <button class="tab" id="tabScan" aria-selected="false">
      <span class="tab-icon">üß™</span>Scan
    </button>
    <button class="tab" id="tabKey" aria-selected="false">
      <span class="tab-icon">üîë</span>Add Link
    </button>
  </div>

  <section class="panel" id="panelAccounts">
    <div class="card">
      <div class="card-head">
        <h3>Th√™m / s·ª≠a t√†i kho·∫£n</h3>
      </div>
      <div class="card-body">
        <div class="field">
          <div class="label"><span>T√†i kho·∫£n *</span></div>
          <input type="text" id="acc_account" placeholder="Nh·∫≠p t√™n t√†i kho·∫£n...">
        </div>
        <div class="field">
          <div class="label"><span>S·ªë ng√†y c√≤n *</span></div>
          <input type="number" id="acc_days" placeholder="VD: 30">
        </div>
        <div class="field">
          <div class="label"><span>Ng√†y h·∫øt h·∫°n (t·ª± t√≠nh)</span></div>
          <input type="date" id="acc_expire">
        </div>
        <div class="field">
          <div class="label"><span>Ghi ch√∫</span></div>
          <textarea id="acc_note" placeholder="Ghi ch√∫ th√™m..."></textarea>
        </div>
        <div class="field">
          <div class="label"><span>Ng∆∞·ªùi d√πng & thi·∫øt b·ªã (t·ªëi ƒëa 3)</span></div>
          <div class="acc-users" id="acc_users"></div>
          <button type="button" class="btn ghost small" id="btnAddUser">+ Th√™m ng∆∞·ªùi d√πng</button>
        </div>
        <div class="acc-form-actions">
          <button type="button" class="btn full" id="btnSaveAccount">L∆∞u t√†i kho·∫£n</button>
          <button type="button" class="btn ghost full" id="btnResetForm">Xo√° form</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <h3>Danh s√°ch t√†i kho·∫£n</h3>
        <span class="badge" id="accSummary">0 t√†i kho·∫£n</span>
      </div>
      <div class="card-body">
        <div id="accList" class="acc-list-empty">Ch∆∞a c√≥ t√†i kho·∫£n n√†o.</div>
      </div>
    </div>
  </section>

  <section class="panel" id="panelCleaner" hidden>
    <div class="card">
      <div class="card-head">
        <h3>Mail Cleaner</h3>
      </div>
      <div class="card-body">
        <div class="field">
          <div class="label"><span>Nh·∫≠p mail</span></div>
          <textarea id="cl_inputArea" class="mono" placeholder="D√°n danh s√°ch mail v√†o ƒë√¢y..."></textarea>
        </div>
        <div class="field">
          <div class="label"><span>T√πy ch·ªçn</span></div>
          <div class="pill-row pill-column">
            <label class="pill-radio">
              <input type="radio" name="clMode" value="mail_only" checked>
              <div class="pill-main">
                <strong>Ch·ªâ mail</strong>
                <span>Xo√° pass, 2FA, d·ªØ li·ªáu th·ª´a</span>
              </div>
            </label>
            <label class="pill-radio">
              <input type="radio" name="clMode" value="mail_pass">
              <div class="pill-main">
                <strong>Mail | Pass</strong>
                <span>Gi·ªØ mail v√† pass</span>
              </div>
            </label>
          </div>
        </div>
        <div class="row">
          <button class="btn small" id="cl_btnProcess">Process</button>
          <button class="btn ghost small" id="cl_btnClear">Xo√° input</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head result-head result-head-main">
        <div class="result-head-main-left">
          <h3>K·∫øt qu·∫£</h3>
          <span class="badge" id="cl_resultStats">0 d√≤ng ‚Üí 0 out</span>
        </div>
        <div class="result-head-actions">
          <button class="btn ghost small" id="cl_btnSelectAll">Ch·ªçn t·∫•t c·∫£</button>
          <button class="btn ghost small" id="cl_btnCopy">Copy</button>
          <button class="btn ghost small" id="cl_btnDownload">T·∫£i .txt</button>
          <button class="btn ghost small" id="cl_btnSaveHistory">L∆∞u l·ªãch s·ª≠</button>
        </div>
      </div>
      <div class="card-body">
        <textarea id="cl_outputArea" class="mono" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y..."></textarea>
      </div>
    </div>
  </section>

  <section class="panel" id="panelScan" hidden>
    <div class="card">
      <div class="card-head">
        <h3>Scan mail</h3>
      </div>
      <div class="card-body">
        <div class="field">
          <div class="label"><span>Nh·∫≠p mail</span></div>
          <textarea id="sc_inputArea" class="mono" placeholder="D√°n danh s√°ch mail v√†o ƒë√¢y..."></textarea>
        </div>
        <div class="field">
          <div class="label"><span>ƒê·ªãnh d·∫°ng xu·∫•t</span></div>
          <div class="pill-row pill-column">
            <label class="pill-radio">
              <input type="radio" name="scMode" value="mail_scan" checked>
              <div class="pill-main">
                <strong>mail|scan</strong>
                <span>ƒê·ªãnh d·∫°ng: mail|xincamon</span>
              </div>
            </label>
            <label class="pill-radio">
              <input type="radio" name="scMode" value="scan_mail">
              <div class="pill-main">
                <strong>scan|mail</strong>
                <span>ƒê·ªãnh d·∫°ng: xincamon|mail</span>
              </div>
            </label>
          </div>
        </div>
        <div class="row">
          <button class="btn small" id="sc_btnProcess">Process</button>
          <button class="btn ghost small" id="sc_btnClear">Xo√° input</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head result-head result-head-main">
        <div class="result-head-main-left">
          <h3>K·∫øt qu·∫£</h3>
          <span class="badge" id="sc_resultStats">0 d√≤ng ‚Üí 0 out</span>
        </div>
        <div class="result-head-actions">
          <button class="btn ghost small" id="sc_btnSelectAll">Ch·ªçn t·∫•t c·∫£</button>
          <button class="btn ghost small" id="sc_btnCopy">Copy</button>
          <button class="btn ghost small" id="sc_btnDownload">T·∫£i .txt</button>
          <button class="btn ghost small" id="sc_btnSaveHistory">L∆∞u l·ªãch s·ª≠</button>
        </div>
      </div>
      <div class="card-body">
        <textarea id="sc_outputArea" class="mono" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y..."></textarea>
      </div>
    </div>
  </section>

  <section class="panel" id="panelKey" hidden>
    <div class="card">
      <div class="card-head">
        <h3>Th√™m link nh·∫≠p key</h3>
      </div>
      <div class="card-body">
        <div class="field">
          <div class="label"><span>ƒê·ªãnh d·∫°ng link nh·∫≠p key</span></div>
          <input type="text" id="lk_linkTemplate" placeholder="VD: https://nhapkey.click">
        </div>
        <div class="field">
          <div class="label"><span>Nh·∫≠p key (m·ªói d√≤ng 1 key)</span></div>
          <textarea id="lk_rawInput" class="mono" placeholder="D√°n danh s√°ch key v√†o ƒë√¢y..."></textarea>
        </div>
        <div class="row">
          <button class="btn small" id="lk_btnProcess">Process</button>
          <button class="btn ghost small" id="lk_btnClear">Xo√° input</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head result-head result-head-main">
        <div class="result-head-main-left">
          <h3>K·∫øt qu·∫£</h3>
          <span class="badge" id="lk_resultStats">0 d√≤ng ‚Üí 0 out</span>
        </div>
        <div class="result-head-actions">
          <button class="btn ghost small" id="lk_btnSelectAll">Ch·ªçn t·∫•t c·∫£</button>
          <button class="btn ghost small" id="lk_btnCopy">Copy</button>
          <button class="btn ghost small" id="lk_btnDownload">T·∫£i .txt</button>
          <button class="btn ghost small" id="lk_btnSaveHistory">L∆∞u l·ªãch s·ª≠</button>
        </div>
      </div>
      <div class="card-body">
        <textarea id="lk_outputArea" class="mono" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y..."></textarea>
      </div>
    </div>
  </section>
</div>

<div class="history-overlay" id="historyPanel">
  <div class="history-backdrop" id="panelBackdrop"></div>
  <div class="history-sheet">
    <div class="history-header">
      <div>
        <div class="history-header-title">L·ªãch s·ª≠</div>
        <div class="history-header-sub">L·ªãch s·ª≠ x·ª≠ l√Ω theo t·ª´ng tab</div>
      </div>
      <button class="icon-btn" id="closePanelBtn">‚úñ</button>
    </div>
    <div class="history-actions">
      <div class="history-actions-right">
        <button class="btn ghost small" id="btnPullCloud">T·∫£i t·ª´ cloud</button>
        <button class="btn ghost small" id="btnPushCloud">ƒê·ªìng b·ªô l√™n cloud</button>
        <button class="btn danger small" id="clearHistoryBtn">Xo√° to√†n b·ªô l·ªãch s·ª≠</button>
      </div>
    </div>
    <div class="history-list" id="historyList"></div>
  </div>
</div>

<div id="toast"></div>

<script>
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));

  function showToast(msg){
    const t = $('#toast');
    if(!t) return;
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 2000);
  }

  /* THEME */
  const LS_THEME = 'multiToolTheme_v1';
  function applyTheme(theme){
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem(LS_THEME, theme);
    const btn = $('#btnToggleTheme');
    if(btn) btn.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
  }
  (function initTheme(){
    const saved = localStorage.getItem(LS_THEME) || 'dark';
    applyTheme(saved);
  })();

  const btnToggleTheme = $('#btnToggleTheme');
  if(btnToggleTheme){
    btnToggleTheme.addEventListener('click', ()=>{
      const cur = document.body.getAttribute('data-theme') || 'dark';
      applyTheme(cur === 'dark' ? 'light' : 'dark');
    });
  }

  /* TABS */
  const elsTabs = {
    tabCleaner: $('#tabCleaner'),
    tabScan: $('#tabScan'),
    tabKey: $('#tabKey'),
    tabAccounts: $('#tabAccounts'),
    panelCleaner: $('#panelCleaner'),
    panelScan: $('#panelScan'),
    panelKey: $('#panelKey'),
    panelAccounts: $('#panelAccounts')
  };

  let currentTab = 'accounts';

  function setActiveTab(tab){
    currentTab = tab;
    const map = {
      accounts:{tab:elsTabs.tabAccounts,panel:elsTabs.panelAccounts},
      cleaner:{tab:elsTabs.tabCleaner,panel:elsTabs.panelCleaner},
      scan:{tab:elsTabs.tabScan,panel:elsTabs.panelScan},
      key:{tab:elsTabs.tabKey,panel:elsTabs.panelKey}
    };
    Object.keys(map).forEach(k=>{
      const {tab:t,panel:p} = map[k];
      if(!t || !p) return;
      if(k===tab){
        t.setAttribute('aria-selected','true');
        p.hidden = false;
      }else{
        t.setAttribute('aria-selected','false');
        p.hidden = true;
      }
    });
  }

  if(elsTabs.tabAccounts){
    elsTabs.tabAccounts.addEventListener('click', ()=>setActiveTab('accounts'));
  }
  if(elsTabs.tabCleaner){
    elsTabs.tabCleaner.addEventListener('click', ()=>setActiveTab('cleaner'));
  }
  if(elsTabs.tabScan){
    elsTabs.tabScan.addEventListener('click', ()=>setActiveTab('scan'));
  }
  if(elsTabs.tabKey){
    elsTabs.tabKey.addEventListener('click', ()=>setActiveTab('key'));
  }

  /* LOCAL STORAGE KEYS */
  const LS_HISTORY = 'multiToolHistory_v3';
  const LS_LINK = 'nk_link_v2';

  function loadHistoryMap(){
    try{
      const raw = localStorage.getItem(LS_HISTORY);
      if(!raw) return {cleaner:[],scan:[],key:[],accounts:[]};
      const obj = JSON.parse(raw);
      return {
        cleaner: Array.isArray(obj.cleaner)?obj.cleaner:[],
        scan: Array.isArray(obj.scan)?obj.scan:[],
        key: Array.isArray(obj.key)?obj.key:[],
        accounts: Array.isArray(obj.accounts)?obj.accounts:[]
      };
    }catch(e){
      return {cleaner:[],scan:[],key:[],accounts:[]};
    }
  }
  function saveHistoryMap(map){
    try{
      localStorage.setItem(LS_HISTORY, JSON.stringify(map));
    }catch(e){}
  }

  function addHistory(type, payload){
    const map = loadHistoryMap();
    const list = map[type] || [];
    const entry = {
      id: 'h_'+Date.now()+'_'+Math.random().toString(16).slice(2),
      ts: Date.now(),
      ...payload
    };
    list.unshift(entry);
    map[type] = list.slice(0, 100);
    saveHistoryMap(map);
    showToast('ƒê√£ l∆∞u v√†o l·ªãch s·ª≠');
  }

  /* ===== FIREBASE (HISTORY + ACCOUNTS) ===== */
  let db = null;
  let firebaseReady = false;
  const cloudStatusEl = document.getElementById('cloudStatus');

  async function initFirebase(){
    try{
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: ƒëang k·∫øt n·ªëi‚Ä¶';
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      await firebase.auth().signInAnonymously();
      firebaseReady = true;
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: OK';
    }catch(e){
      console.warn('Firebase init failed', e);
      firebaseReady = false;
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: l·ªói init';
    }
  }
  const getHistoryDocRef = () => db.collection('lockey_suite').doc('history');

  async function syncHistoryFromCloud(){
    if(!firebaseReady || !db){
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: ch∆∞a s·∫µn s√†ng';
      return;
    }
    try{
      const snap = await getHistoryDocRef().get();
      if(snap.exists){
        const data = snap.data() || {};
        const map = {
          cleaner: data.cleaner || [],
          scan: data.scan || [],
          key: data.key || [],
          accounts: data.accounts || []
        };
        saveHistoryMap(map);
        if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: OK';
      }else{
        if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: OK (ch∆∞a c√≥ l·ªãch s·ª≠)';
      }
    }catch(e){
      console.warn('syncHistoryFromCloud error', e);
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: l·ªói ƒë·ªçc l·ªãch s·ª≠';
    }
  }

  async function syncHistoryToCloud(){
    if(!firebaseReady || !db){
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: ch∆∞a s·∫µn s√†ng';
      return;
    }
    try{
      const map = loadHistoryMap();
      await getHistoryDocRef().set(map);
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: OK';
    }catch(e){
      console.warn('syncHistoryToCloud error', e);
      if(cloudStatusEl) cloudStatusEl.textContent = 'Cloud: l·ªói ghi l·ªãch s·ª≠';
    }
  }

  initFirebase();

  /* ‚≠êÔ∏è M·ªöI: C·∫ßn tham chi·∫øu ƒë·∫øn c√°c input n√†y cho n√∫t "N·∫°p v√†o tab" */
  const cl_inputArea = $('#cl_inputArea');
  const sc_inputArea = $('#sc_inputArea');
  const lk_rawInput = $('#lk_rawInput');
  
  /* HISTORY UI */
  const historyPanel = $('#historyPanel');
  const historyBackdrop = $('#panelBackdrop');
  const historyListEl = $('#historyList');
  const btnToggleHistory = $('#toggleHistoryBtn');
  const btnClosePanel = $('#closePanelBtn');
  const btnClearHistory = $('#clearHistoryBtn');
  const btnPullCloud = $('#btnPullCloud');
  const btnPushCloud = $('#btnPushCloud');

  function formatTs(ts){
    try{
      const d = new Date(ts);
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yy = d.getFullYear();
      const hh = String(d.getHours()).padStart(2,'0');
      const mi = String(d.getMinutes()).padStart(2,'0');
      const ss = String(d.getSeconds()).padStart(2,'0');
      return `${dd}/${mm}/${yy} ${hh}:${mi}:${ss}`;
    }catch(e){
      return '';
    }
  }

  function openHistoryPanel(){
    if(!historyPanel) return;
    historyPanel.classList.add('open');
    renderHistoryFor(currentTab);
  }
  function closeHistoryPanel(){
    if(!historyPanel) return;
    historyPanel.classList.remove('open');
  }

  if(btnToggleHistory){
    btnToggleHistory.addEventListener('click', openHistoryPanel);
  }
  if(btnClosePanel){
    btnClosePanel.addEventListener('click', closeHistoryPanel);
  }
  if(historyBackdrop){
    historyBackdrop.addEventListener('click', closeHistoryPanel);
  }

  if(btnClearHistory){
    btnClearHistory.addEventListener('click', ()=>{
      const map = {cleaner:[],scan:[],key:[],accounts:[]};
      saveHistoryMap(map);
      renderHistoryFor(currentTab);
      showToast('ƒê√£ xo√° to√†n b·ªô l·ªãch s·ª≠');
    });
  }

  if(btnPullCloud){
    btnPullCloud.addEventListener('click', syncHistoryFromCloud);
  }
  if(btnPushCloud){
    btnPushCloud.addEventListener('click', syncHistoryToCloud);
  }

  function renderHistoryFor(tab){
    if(!historyListEl) return;
    const map = loadHistoryMap();
    const list = map[tab] || [];
    if(!list.length){
      historyListEl.innerHTML = '<div class="history-empty">Ch∆∞a c√≥ l·ªãch s·ª≠ cho tab n√†y.</div>';
      return;
    }
    historyListEl.innerHTML = '';
    list.forEach(item=>{
      const div = document.createElement('div');
      div.className = 'h-item';
      div.dataset.id = item.id;
      div.innerHTML = `
        <button class="h-btn">
          <div class="h-main">
            <div class="h-line1">${item.title || 'L·∫ßn x·ª≠ l√Ω'}</div>
            <div class="h-line2">${formatTs(item.ts)}</div>
          </div>
          <span class="h-tag">${tab.toUpperCase()}</span>
        </button>
        <div class="h-body">
          <div class="h-cols">
            <div class="field">
              <div class="label"><span>Input</span></div>
              <textarea class="history-ta mono history-ta-input" readonly>${item.input || ''}</textarea>
            </div>
            <div class="field">
              <div class="label"><span>K·∫øt qu·∫£</span></div>
              <textarea class="history-ta mono history-ta-output" readonly>${item.output || ''}</textarea>
            </div>
          </div>
          <div class="h-body-actions">
            <button class="btn ghost small" data-act="copy-input">Copy Input</button>
            <button class="btn ghost small" data-act="copy-output">Copy Output</button>
            <button class="btn ghost small" data-act="load-tab">N·∫°p v√†o tab</button>
            <button class="btn danger small" data-act="delete-item">Xo√° l√¥</button>
          </div>
        </div>
      `;
      
      const btn = div.querySelector('.h-btn');
      const body = div.querySelector('.h-body');
      btn.addEventListener('click', ()=>{
        body.style.display = body.style.display === 'block' ? 'none' : 'block';
      });

      const actions = div.querySelectorAll('.h-body-actions button');
      actions.forEach(b=>{
        b.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          const act = b.dataset.act;
          const id = div.dataset.id;
          handleHistoryAction(tab, id, act, div);
        });
      });

      historyListEl.appendChild(div);
    });
  }

  async function handleHistoryAction(tab, id, act, element){
    const map = loadHistoryMap();
    const list = map[tab] || [];
    const idx = list.findIndex(x=>x.id===id);
    if(idx === -1) return;
    const item = list[idx];

    if(act === 'copy-input'){
      navigator.clipboard.writeText(item.input || '');
      showToast('ƒê√£ copy input');
    }else if(act === 'copy-output'){
      navigator.clipboard.writeText(item.output || '');
      showToast('ƒê√£ copy k·∫øt qu·∫£');
    }else if(act === 'load-tab'){
      if(tab === 'cleaner' && cl_inputArea){
        cl_inputArea.value = item.input || '';
      }else if(tab === 'scan' && sc_inputArea){
        sc_inputArea.value = item.input || '';
      }else if(tab === 'key' && lk_rawInput){
        lk_rawInput.value = item.input || '';
      }
      showToast('ƒê√£ n·∫°p v√†o tab');
    }else if(act === 'delete-item'){
      list.splice(idx,1);
      map[tab] = list;
      saveHistoryMap(map);
      element.remove();
      showToast('ƒê√£ xo√° l√¥ kh·ªèi l·ªãch s·ª≠');
      if(!list.length){
        renderHistoryFor(tab);
      }
    }
  }

  /* ACCOUNT LOGIC (local only, kh√¥ng cloud) */
  const accUsersEl = $('#acc_users');
  const accListEl = $('#accList');
  const accSummaryEl = $('#accSummary');
  const btnAddUser = $('#btnAddUser');
  const btnSaveAccount = $('#btnSaveAccount');
  const btnResetForm = $('#btnResetForm');

  const LS_ACCOUNTS = 'tk_accounts_v2';
  let accData = [];

  function loadAccounts(){
    try{
      const raw = localStorage.getItem(LS_ACCOUNTS);
      if(!raw) return [];
      return JSON.parse(raw);
    }catch(e){
      return [];
    }
  }
  function saveAccounts(){
    try{
      localStorage.setItem(LS_ACCOUNTS, JSON.stringify(accData));
    }catch(e){}
  }

  function resetAccUsers(){
    if(!accUsersEl) return;
    accUsersEl.innerHTML = '';
    addUserRow();
  }

  function addUserRow(value=''){
    if(!accUsersEl) return;
    const idx = accUsersEl.children.length + 1;
    const div = document.createElement('div');
    div.className = 'acc-user-row';
    div.innerHTML = `
      <div class="acc-user-row-title">Ng∆∞·ªùi d√πng / Thi·∫øt b·ªã ${idx}</div>
      <input type="text" class="acc-user-input" placeholder="VD: User A - iPhone 11" value="${value}">
    `;
    accUsersEl.appendChild(div);
  }

  function readForm(){
    const account = $('#acc_account').value.trim();
    const days = parseInt($('#acc_days').value.trim() || '0',10);
    const expireDate = $('#acc_expire').value || '';
    const note = $('#acc_note').value.trim();
    const userInputs = $$('.acc-user-input').map(i=>i.value.trim()).filter(x=>x);
    if(!account || !days){
      showToast('ƒêi·ªÅn ƒë·∫ßy ƒë·ªß t√†i kho·∫£n v√† s·ªë ng√†y');
      return null;
    }
    return {
      id: 'acc_'+Date.now(),
      account,
      days,
      expireDate,
      note,
      users:userInputs,
      createdAt: Date.now()
    };
  }

  function renderAccounts(){
    if(!accListEl) return;
    if(!accData.length){
      accListEl.classList.add('acc-list-empty');
      accListEl.innerHTML = 'Ch∆∞a c√≥ t√†i kho·∫£n n√†o.';
      if(accSummaryEl) accSummaryEl.textContent = '0 t√†i kho·∫£n';
      return;
    }
    accListEl.classList.remove('acc-list-empty');
    if(accSummaryEl) accSummaryEl.textContent = accData.length+' t√†i kho·∫£n';

    accListEl.innerHTML = '';
    accData.forEach((acc, index)=>{
      const div = document.createElement('div');
      div.className = 'acc-item';
      const users = (acc.users||[]).join(', ');
      div.innerHTML = `
        <button class="acc-head-btn">
          <div>
            <div class="acc-title">${acc.account}</div>
            <div class="acc-sub">C√≤n ${acc.days} ng√†y ‚Ä¢ ${users || 'Ch∆∞a c√≥ ng∆∞·ªùi d√πng'}</div>
          </div>
          <div class="acc-badges">
            <span class="acc-badge">#${index+1}</span>
          </div>
        </button>
        <div class="acc-body">
          <div class="acc-body-grid">
            <div class="field">
              <div class="label"><span>Ghi ch√∫</span></div>
              <textarea readonly>${acc.note || ''}</textarea>
            </div>
          </div>
          <div class="acc-body-actions">
            <button class="btn ghost small" data-act="delete">Xo√°</button>
          </div>
        </div>
      `;
      const btn = div.querySelector('.acc-head-btn');
      const body = div.querySelector('.acc-body');
      btn.addEventListener('click', ()=>{
        body.style.display = body.style.display === 'block' ? 'none' : 'block';
      });
      const btnDel = div.querySelector('[data-act="delete"]');
      btnDel.addEventListener('click', (ev)=>{
        ev.stopPropagation();
        accData.splice(index,1);
        saveAccounts();
        renderAccounts();
        showToast('ƒê√£ xo√° t√†i kho·∫£n');
      });

      accListEl.appendChild(div);
    });
  }

  function resetForm(){
    $('#acc_account').value = '';
    $('#acc_days').value = '';
    $('#acc_expire').value = '';
    $('#acc_note').value = '';
    resetAccUsers();
  }

  if(btnAddUser){
    btnAddUser.addEventListener('click', ()=>{
      if(accUsersEl && accUsersEl.children.length >=3){
        showToast('T·ªëi ƒëa 3 ng∆∞·ªùi d√πng / thi·∫øt b·ªã');
        return;
      }
      addUserRow();
    });
  }

  if(btnSaveAccount){
    btnSaveAccount.addEventListener('click', ()=>{
      const data = readForm();
      if(!data) return;
      accData.unshift(data);
      saveAccounts();
      addHistory('accounts',{
        title:`T√†i kho·∫£n: ${data.account}`,
        input:`${data.account}`,
        output:`S·ªë ng√†y: ${data.days}`
      });
      renderAccounts();
      showToast('ƒê√£ l∆∞u t√†i kho·∫£n');
    });
  }

  if(btnResetForm){
    btnResetForm.addEventListener('click', resetForm);
  }

  /* CLEANER LOGIC */
  function processCleaner(){
    const input = $('#cl_inputArea').value.trim();
    if(!input){
      showToast('Ch∆∞a c√≥ d·ªØ li·ªáu');
      return;
    }
    const mode = (document.querySelector('input[name="clMode"]:checked')||{}).value || 'mail_only';
    const lines = input.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
    const out = lines.map(l=>{
      const parts = l.split('|');
      const mail = parts[0] || '';
      const pass = parts[1] || '';
      if(mode === 'mail_only') return mail;
      return mail+'|'+pass;
    });
    $('#cl_outputArea').value = out.join('\n');
    $('#cl_resultStats').textContent = `${lines.length} d√≤ng ‚Üí ${out.length} out`;
    addHistory('cleaner',{
      title:'Mail Cleaner',
      input,
      output: out.join('\n')
    });
  }

  if($('#cl_btnProcess')){
    $('#cl_btnProcess').addEventListener('click', processCleaner);
  }
  if($('#cl_btnClear')){
    $('#cl_btnClear').addEventListener('click', ()=>{
      $('#cl_inputArea').value='';
      $('#cl_outputArea').value='';
      $('#cl_resultStats').textContent='0 d√≤ng ‚Üí 0 out';
    });
  }
  if($('#cl_btnSelectAll')){
    $('#cl_btnSelectAll').addEventListener('click', ()=>{
      $('#cl_outputArea').focus();
      $('#cl_outputArea').select();
    });
  }
  if($('#cl_btnCopy')){
    $('#cl_btnCopy').addEventListener('click', ()=>{
      navigator.clipboard.writeText($('#cl_outputArea').value||'');
      showToast('ƒê√£ copy');
    });
  }
  if($('#cl_btnDownload')){
    $('#cl_btnDownload').addEventListener('click', ()=>{
      const blob = new Blob([$('#cl_outputArea').value||''],{type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'cleaner_result.txt';
      a.click();
    });
  }
  if($('#cl_btnSaveHistory')){
    $('#cl_btnSaveHistory').addEventListener('click', ()=>{
      if(!$('#cl_outputArea').value.trim()){
        showToast('Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ l∆∞u');
        return;
      }
      addHistory('cleaner',{
        title:'Mail Cleaner (nh·∫•n l∆∞u)',
        input:$('#cl_inputArea').value,
        output:$('#cl_outputArea').value
      });
    });
  }

  /* SCAN LOGIC */
  function processScan(){
    const input = $('#sc_inputArea').value.trim();
    if(!input){
      showToast('Ch∆∞a c√≥ d·ªØ li·ªáu');
      return;
    }
    const mode = (document.querySelector('input[name="scMode"]:checked')||{}).value || 'mail_scan';
    const lines = input.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
    const out = lines.map(l=>{
      const mail = l.split('|')[0] || l;
      if(mode === 'mail_scan') return `${mail}|xincamon`;
      return `xincamon|${mail}`;
    });
    $('#sc_outputArea').value = out.join('\n');
    $('#sc_resultStats').textContent = `${lines.length} d√≤ng ‚Üí ${out.length} out`;
    addHistory('scan',{
      title:'Scan mail',
      input,
      output: out.join('\n')
    });
  }

  if($('#sc_btnProcess')){
    $('#sc_btnProcess').addEventListener('click', processScan);
  }
  if($('#sc_btnClear')){
    $('#sc_btnClear').addEventListener('click', ()=>{
      $('#sc_inputArea').value='';
      $('#sc_outputArea').value='';
      $('#sc_resultStats').textContent='0 d√≤ng ‚Üí 0 out';
    });
  }
  if($('#sc_btnSelectAll')){
    $('#sc_btnSelectAll').addEventListener('click', ()=>{
      $('#sc_outputArea').focus();
      $('#sc_outputArea').select();
    });
  }
  if($('#sc_btnCopy')){
    $('#sc_btnCopy').addEventListener('click', ()=>{
      navigator.clipboard.writeText($('#sc_outputArea').value||'');
      showToast('ƒê√£ copy');
    });
  }
  if($('#sc_btnDownload')){
    $('#sc_btnDownload').addEventListener('click', ()=>{
      const blob = new Blob([$('#sc_outputArea').value||''],{type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'scan_result.txt';
      a.click();
    });
  }
  if($('#sc_btnSaveHistory')){
    $('#sc_btnSaveHistory').addEventListener('click', ()=>{
      if(!$('#sc_outputArea').value.trim()){
        showToast('Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ l∆∞u');
        return;
      }
      addHistory('scan',{
        title:'Scan mail (nh·∫•n l∆∞u)',
        input:$('#sc_inputArea').value,
        output:$('#sc_outputArea').value
      });
    });
  }

  /* LINK / KEY LOGIC */
  (function initLink(){
    const saved = localStorage.getItem(LS_LINK);
    if(saved){
      $('#lk_linkTemplate').value = saved;
    }
  })();

  if($('#lk_linkTemplate')){
    $('#lk_linkTemplate').addEventListener('input', ()=>{
      localStorage.setItem(LS_LINK, $('#lk_linkTemplate').value.trim());
    });
  }

  function processLink(){
    const tpl = $('#lk_linkTemplate').value.trim();
    if(!tpl){
      showToast('Ch∆∞a nh·∫≠p link nh·∫≠p key');
      return;
    }
    const input = $('#lk_rawInput').value.trim();
    if(!input){
      showToast('Ch∆∞a c√≥ d·ªØ li·ªáu');
      return;
    }
    const lines = input.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
    const out = lines.map(k=>`Key:${k}|link nh·∫≠p key:${tpl}`);
    $('#lk_outputArea').value = out.join('\n');
    $('#lk_resultStats').textContent = `${lines.length} d√≤ng ‚Üí ${out.length} out`;
    addHistory('key',{
      title:'Add Link',
      input,
      output: out.join('\n')
    });
  }

  if($('#lk_btnProcess')){
    $('#lk_btnProcess').addEventListener('click', processLink);
  }
  if($('#lk_btnClear')){
    $('#lk_btnClear').addEventListener('click', ()=>{
      $('#lk_rawInput').value='';
      $('#lk_outputArea').value='';
      $('#lk_resultStats').textContent='0 d√≤ng ‚Üí 0 out';
    });
  }
  if($('#lk_btnSelectAll')){
    $('#lk_btnSelectAll').addEventListener('click', ()=>{
      $('#lk_outputArea').focus();
      $('#lk_outputArea').select();
    });
  }
  if($('#lk_btnCopy')){
    $('#lk_btnCopy').addEventListener('click', ()=>{
      navigator.clipboard.writeText($('#lk_outputArea').value||'');
      showToast('ƒê√£ copy');
    });
  }
  if($('#lk_btnDownload')){
    $('#lk_btnDownload').addEventListener('click', ()=>{
      const blob = new Blob([$('#lk_outputArea').value||''],{type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'link_result.txt';
      a.click();
    });
  }
  if($('#lk_btnSaveHistory')){
    $('#lk_btnSaveHistory').addEventListener('click', ()=>{
      if(!$('#lk_outputArea').value.trim()){
        showToast('Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ l∆∞u');
        return;
      }
      addHistory('key',{
        title:'Add Link (nh·∫•n l∆∞u)',
        input:$('#lk_rawInput').value,
        output:$('#lk_outputArea').value
      });
    });
  }

  /* INIT */
  (function init(){
    accData = loadAccounts();
    renderAccounts();
    resetAccUsers();
    setActiveTab('accounts');
  })();
</script>
</body>
</html>